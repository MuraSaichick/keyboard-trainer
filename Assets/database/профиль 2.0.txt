import QtQuick 2.15
import QtQuick.Controls 2.15
import QtQuick.Layouts 1.15

ApplicationWindow {
    id: mainWindow
    width: 950
    height: 700
    minimumHeight: 700
    minimumWidth: 950
    visible: false
    title: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä - –ü—Ä–æ—Ñ–∏–ª—å"

    property string selectedLanguage: "russian"

    Rectangle {
        anchors.fill: parent
        color: themeManager.background

        ColumnLayout {
            anchors.fill: parent
            anchors.margins: 30
            spacing: 20
            clip: false

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è
            Rectangle {
                Layout.fillWidth: true
                height: 100
                color: themeManager.inputBackground
                radius: 15
                border.color: themeManager.border
                border.width: 1

                RowLayout {
                    anchors.verticalCenter: parent.verticalCenter
                    anchors.left: parent.left
                    anchors.leftMargin: 20
                    spacing: 20

                    // –ê–≤–∞—Ç–∞—Ä
                    Rectangle {
                        width: 50
                        height: 50
                        radius: 25
                        color: themeManager.highlight

                        Text {
                            anchors.centerIn: parent
                            text: "M"
                            color: themeManager.highlightedText
                            font.pixelSize: 20
                            font.bold: true
                        }
                    }

                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                    ColumnLayout {
                        Layout.fillWidth: true
                        spacing: 5

                        Text {
                            text: "MuraSaichick"
                            font.pixelSize: 20
                            font.bold: true
                            color: themeManager.text
                        }

                        Text {
                            text: "ID: #12345"
                            font.pixelSize: 14
                            color: themeManager.placeHolderText
                        }
                    }
                }
                // –í—ã–±–æ—Ä —è–∑—ã–∫–∞
                SettingItem {
                    id: languageItem
                    width: 100
                    anchors.top: parent.top
                    anchors.topMargin: 5
                    anchors.right: parent.right
                    anchors.rightMargin: 50
                    height: 50
                    iconText: "üåê"
                    settingText: qsTr("–Ø–∑—ã–∫")

                    ComboBox {
                        id: languageComboBox
                        width: 140
                        height: 36
                        font.pixelSize: 15
                        anchors.top: parent.bottom
                        anchors.horizontalCenter: parent.horizontalCenter

                        background: Rectangle {
                            color: themeManager.inputBackground
                            radius: 8
                            border.color: languageComboBox.hovered ? themeManager.buttonHoverColor : themeManager.border
                            border.width: languageComboBox.hovered ? 2 : 1

                            Behavior on border.color {
                                ColorAnimation { duration: 150 }
                            }

                            Behavior on border.width {
                                NumberAnimation { duration: 150 }
                            }
                        }

                        contentItem: Text {
                            text: languageComboBox.currentText
                            font.pixelSize: 15
                            color: themeManager.inputTextColor
                            verticalAlignment: Text.AlignVCenter
                            horizontalAlignment: Text.AlignHCenter
                        }

                        indicator: Text {
                            text: "‚ñº"
                            font.pixelSize: 12
                            color: themeManager.text
                            anchors.right: parent.right
                            anchors.rightMargin: 10
                            anchors.verticalCenter: parent.verticalCenter
                        }

                        model: ["–†—É—Å—Å–∫–∏–π", "English"]
                        currentIndex: 0

                        delegate: ItemDelegate {
                            width: parent.width
                            height: 36

                            background: Rectangle {
                                color: highlighted ? themeManager.button : themeManager.background
                                radius: 5
                                border.color: themeManager.border
                                border.width: 1
                            }

                            contentItem: Text {
                                text: modelData
                                font.pixelSize: 14
                                color: themeManager.text
                                verticalAlignment: Text.AlignVCenter
                                horizontalAlignment: Text.AlignHCenter
                            }
                        }

                        popup: Popup {
                            y: languageComboBox.height
                            width: languageComboBox.width
                            implicitHeight: contentItem.implicitHeight
                            padding: 1

                            contentItem: ListView {
                                clip: true
                                implicitHeight: contentHeight
                                model: languageComboBox.popup.visible ? languageComboBox.delegateModel : null
                                currentIndex: languageComboBox.highlightedIndex

                                ScrollIndicator.vertical: ScrollIndicator { }
                            }

                            background: Rectangle {
                                color: themeManager.background
                                radius: 8
                                border.color: themeManager.border
                                border.width: 1
                            }

                            enter: Transition {
                                NumberAnimation { property: "opacity"; from: 0.0; to: 1.0; duration: 150 }
                            }

                            exit: Transition {
                                NumberAnimation { property: "opacity"; from: 1.0; to: 0.0; duration: 150 }
                            }
                        }
                    }
                }
            }

            // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
            ScrollView {
                Layout.fillWidth: true
                Layout.fillHeight: true

                ColumnLayout {
                    width: parent.width
                    spacing: 25

                    // –¢–µ—Å—Ç—ã –Ω–∞ —Å–ª–æ–≤–∞
                    TestTypeSection {
                        title: "–¢–µ—Å—Ç—ã –Ω–∞ —Å–ª–æ–≤–∞"
                        icon: "üìù"
                        testType: "words"
                        testData: [
                            { mode: "10 —Å–ª–æ–≤", speed: "85", accuracy: "96.2%", maxSpeed: "92", stability: "87%" },
                            { mode: "25 —Å–ª–æ–≤", speed: "78", accuracy: "94.8%", maxSpeed: "86", stability: "82%" },
                            { mode: "50 —Å–ª–æ–≤", speed: "72", accuracy: "93.1%", maxSpeed: "81", stability: "78%" },
                            { mode: "100 —Å–ª–æ–≤", speed: "68", accuracy: "91.5%", maxSpeed: "76", stability: "74%" }
                        ]
                    }

                    // –¢–µ—Å—Ç—ã –Ω–∞ –≤—Ä–µ–º—è
                    TestTypeSection {
                        title: "–¢–µ—Å—Ç—ã –Ω–∞ –≤—Ä–µ–º—è"
                        icon: "‚è±Ô∏è"
                        testType: "time"
                        testData: [
                            { mode: "15 —Å–µ–∫", speed: "92", accuracy: "97.1%", maxSpeed: "105", stability: "89%" },
                            { mode: "30 —Å–µ–∫", speed: "87", accuracy: "95.6%", maxSpeed: "98", stability: "85%" },
                            { mode: "60 —Å–µ–∫", speed: "81", accuracy: "94.2%", maxSpeed: "93", stability: "81%" },
                            { mode: "120 —Å–µ–∫", speed: "75", accuracy: "92.8%", maxSpeed: "87", stability: "77%" }
                        ]
                    }

                    // –¢–µ—Å—Ç—ã –Ω–∞ —Ç–µ–∫—Å—Ç
                    TestTypeSection {
                        title: "–¢–µ—Å—Ç—ã –Ω–∞ —Ç–µ–∫—Å—Ç"
                        icon: "üìÑ"
                        testType: "text"
                        testData: [
                            { mode: "60 —Å–µ–∫", speed: "79", accuracy: "96.5%", maxSpeed: "89", stability: "83%" },
                            { mode: "120 —Å–µ–∫", speed: "76", accuracy: "94.8%", maxSpeed: "85", stability: "79%" },
                            { mode: "180 —Å–µ–∫", speed: "73", accuracy: "93.2%", maxSpeed: "82", stability: "76%" },
                            { mode: "300 —Å–µ–∫", speed: "70", accuracy: "91.7%", maxSpeed: "78", stability: "73%" }
                        ]
                    }

                    // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    StatsSection {
                        title: "–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
                        icon: "üìä"

                        GridLayout {
                            columns: 3
                            columnSpacing: 15
                            rowSpacing: 15
                            Layout.fillWidth: true

                            BigStatCard {
                                title: "–í—Å–µ–≥–æ –Ω–∞–∂–∞—Ç–æ –∫–ª–∞–≤–∏—à"
                                value: "1,245,678"
                                icon: "‚å®Ô∏è"
                            }

                            BigStatCard {
                                title: "–í—Å–µ–≥–æ –ø—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤"
                                value: "342"
                                icon: "üìù"
                            }
                            BigStatCard {
                                title: "–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—á–∞—Ç–∏"
                                value: "389 –º–∏–Ω—É—Ç"
                                icon: "‚è≥"
                            }
                        }
                    }

                    // –£—Ä–æ–∫–∏
                    StatsSection {
                        title: "–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–∫–æ–≤"
                        icon: "üìö"

                        Rectangle {
                            Layout.fillWidth: true
                            height: 80
                            color: themeManager.inputBackground
                            radius: 10
                            border.color: themeManager.border
                            border.width: 1

                            RowLayout {
                                anchors.fill: parent
                                anchors.margins: 20
                                spacing: 20

                                Text {
                                    text: "üìñ"
                                    font.pixelSize: 32
                                }

                                ColumnLayout {
                                    Layout.fillWidth: true
                                    spacing: 5

                                    RowLayout {
                                        Text {
                                            text: "–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤:"
                                            font.pixelSize: 14
                                            color: themeManager.text
                                        }

                                        Text {
                                            text: selectedLanguage === "russian" ? "18 –∏–∑ 25" : "12 –∏–∑ 20"
                                            font.pixelSize: 14
                                            font.bold: true
                                            color: themeManager.highlight
                                        }
                                    }

                                    ProgressBar {
                                        Layout.fillWidth: true
                                        value: selectedLanguage === "russian" ? 0.72 : 0.6

                                        background: Rectangle {
                                            color: themeManager.border
                                            radius: 8
                                        }

                                        contentItem: Rectangle {
                                            color: themeManager.highlight
                                            radius: 8
                                        }
                                    }
                                }

                                Text {
                                    text: selectedLanguage === "russian" ? "72%" : "60%"
                                    font.pixelSize: 18
                                    font.bold: true
                                    color: themeManager.highlight
                                }
                            }
                        }
                    }
                }
            }

            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            Rectangle {
                id: escapeButton
                width: escapeButtonText.width + 20
                height: 50
                color: themeManager.button
                radius: 10
                border.color: themeManager.border
                border.width: 1

                MouseArea {
                    anchors.fill: parent
                    hoverEnabled: true
                    cursorShape: Qt.PointingHandCursor

                    onEntered: parent.color = themeManager.buttonHoverColor
                    onExited: parent.color = themeManager.button

                    onClicked: {
                        console.log("–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞")
                    }
                }

                Text {
                    id: escapeButtonText
                    anchors.centerIn: parent
                    text: "üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞"
                    font.pixelSize: 16
                    color: themeManager.text
                }
            }
        }
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ–∫—Ü–∏–∏ —Å —Ç–∏–ø–∞–º–∏ —Ç–µ—Å—Ç–æ–≤
    component TestTypeSection: ColumnLayout {
        property string title
        property string icon
        property string testType
        property var testData: []

        spacing: 15
        Layout.fillWidth: true

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
        RowLayout {
            spacing: 10

            Text {
                text: parent.parent.icon
                font.pixelSize: 24
            }

            Text {
                text: parent.parent.title
                font.pixelSize: 18
                font.bold: true
                color: themeManager.text
            }

            Rectangle {
                Layout.fillWidth: true
                height: 1
                color: themeManager.border
            }
        }

        // –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–µ—Å—Ç–æ–≤
        GridLayout {
            columns: 4
            columnSpacing: 15
            rowSpacing: 10
            Layout.fillWidth: true

            Repeater {
                model: testData

                TestCard {
                    testMode: modelData.mode
                    speed: modelData.speed
                    accuracy: modelData.accuracy
                    maxSpeed: modelData.maxSpeed
                    stability: modelData.stability
                }
            }
        }
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ—Å—Ç–∞
    component TestCard: Rectangle {
        property string testMode
        property string speed
        property string accuracy
        property string maxSpeed
        property string stability

        Layout.preferredWidth: 200
        Layout.preferredHeight: 80
        color: themeManager.inputBackground
        radius: 10
        border.color: themeManager.border
        border.width: 1

        MouseArea {
            id: cardMouseArea
            anchors.fill: parent
            hoverEnabled: true

            onEntered: {
                globalHoverInfo.showForCard(parent, cardMouseArea)
            }

            onExited: {
                globalHoverInfo.hide()
            }

            onPositionChanged: {
                if (containsMouse) {
                    globalHoverInfo.showForCard(parent, cardMouseArea)
                }
            }
        }

        ColumnLayout {
            anchors.centerIn: parent
            spacing: 5

            Text {
                text: speed + " WPM"
                font.pixelSize: 20
                font.bold: true
                color: themeManager.highlight
                Layout.alignment: Qt.AlignHCenter
            }

            Text {
                text: testMode
                font.pixelSize: 12
                color: themeManager.placeHolderText
                Layout.alignment: Qt.AlignHCenter
            }
        }
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    component StatsSection: ColumnLayout {
        property string title
        property string icon

        spacing: 15
        Layout.fillWidth: true

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
        RowLayout {
            spacing: 10

            Text {
                text: parent.parent.icon
                font.pixelSize: 24
            }

            Text {
                text: parent.parent.title
                font.pixelSize: 18
                font.bold: true
                color: themeManager.text
            }

            Rectangle {
                Layout.fillWidth: true
                height: 1
                color: themeManager.border
            }
        }
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –±–æ–ª—å—à–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    component BigStatCard: Rectangle {
        property string title
        property string value
        property string icon

        Layout.fillWidth: true
        Layout.preferredHeight: 100
        color: themeManager.inputBackground
        radius: 10
        border.color: themeManager.border
        border.width: 1

        RowLayout {
            anchors.fill: parent
            anchors.margins: 20
            spacing: 20

            Text {
                text: parent.parent.icon
                font.pixelSize: 40
            }

            ColumnLayout {
                Layout.fillWidth: true
                spacing: 5

                Text {
                    text: parent.parent.parent.value
                    font.pixelSize: 28
                    font.bold: true
                    color: themeManager.highlight
                }

                Text {
                    text: parent.parent.parent.title
                    font.pixelSize: 14
                    color: themeManager.text
                }
            }
        }
    }

    // —Å–º–µ–Ω–∞ —è–∑—ã–∫–∞
    component SettingItem: Item {
        property string iconText: ""
        property string settingText: ""
        height: 50
        width: implicitWidth

        Row {
            spacing: 10
            anchors.verticalCenter: parent.verticalCenter

            Rectangle {
                id: iconBg
                width: 36
                height: 36
                radius: 8
                color: themeManager.button
                opacity: 0.8

                Text {
                    anchors.centerIn: parent
                    text: iconText
                    font.pixelSize: 18
                }
            }

            Text {
                id: settingLabel
                text: settingText
                anchors.verticalCenter: parent.verticalCenter
                font.pixelSize: 15
                font.family: "Arial"
                color: themeManager.text
                verticalAlignment: Text.AlignVCenter
            }
        }
    }

    // –ö—Ä—á –≤—Å–ª—ã–ø–∞—é—â–µ–µ –æ–∫–Ω–æ
    Rectangle {
        id: globalHoverInfo
        width: 220
        height: 120
        color: themeManager.background
        radius: 10
        border.color: themeManager.border
        border.width: 1
        visible: false
        z: 10000 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π z-order

        property var currentCard: null

        function showForCard(card, mouseArea) {
            if (!card) return

            currentCard = card
            visible = true

            // –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏
            var globalPos = mouseArea.mapToItem(mainWindow.contentItem, 0, 0)

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º tooltip –Ω–∞–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π
            x = globalPos.x + (mouseArea.width - width) / 2
            y = globalPos.y - height - 8

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –æ–∫–Ω–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é
            if (x < 10) x = 10
            if (x + width > mainWindow.width - 10) x = mainWindow.width - width - 10
            if (y < 10) y = globalPos.y + mouseArea.height + 10
        }

        function hide() {
            visible = false
            currentCard = null
        }

        ColumnLayout {
            anchors.fill: parent
            anchors.margins: 15
            spacing: 8

            Text {
                text: "üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
                font.pixelSize: 13
                font.bold: true
                color: themeManager.text
                Layout.alignment: Qt.AlignHCenter
            }

            Rectangle {
                Layout.fillWidth: true
                height: 1
                color: themeManager.border
            }

            GridLayout {
                columns: 2
                columnSpacing: 15
                rowSpacing: 5
                Layout.fillWidth: true

                Text {
                    text: "–¢–æ—á–Ω–æ—Å—Ç—å:"
                    font.pixelSize: 11
                    color: themeManager.placeHolderText
                }
                Text {
                    text: globalHoverInfo.currentCard ? globalHoverInfo.currentCard.accuracy : ""
                    font.pixelSize: 11
                    color: themeManager.text
                    font.bold: true
                }

                Text {
                    text: "–ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å:"
                    font.pixelSize: 11
                    color: themeManager.placeHolderText
                }
                Text {
                    text: globalHoverInfo.currentCard ? globalHoverInfo.currentCard.maxSpeed + " WPM" : ""
                    font.pixelSize: 11
                    color: themeManager.text
                    font.bold: true
                }

                Text {
                    text: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:"
                    font.pixelSize: 11
                    color: themeManager.placeHolderText
                }
                Text {
                    text: globalHoverInfo.currentCard ? globalHoverInfo.currentCard.stability : ""
                    font.pixelSize: 11
                    color: themeManager.text
                    font.bold: true
                }
            }
        }
        Rectangle {
            width: 10
            height: 10
            color: themeManager.background
            border.color: themeManager.border
            border.width: 1
            rotation: 45
            anchors.horizontalCenter: parent.horizontalCenter
            anchors.bottom: parent.bottom
            anchors.bottomMargin: -5
        }
    }
}
